{% extends "core/base.html" %}
{% load static %}

{% block title %}Password Strength Checker{% endblock %}


{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block content %}
<div class="container" style="max-width: 900px;">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h3 class="fw-bold mb-0">Password Strength Checker</h3>
            <small class="text-muted">Check the strength of your password and get tips to improve it</small>
        </div>
    
    </div>

    <div class="row g-4">
        <!-- ================= Password Input Section ================= -->
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-4">
                    <h5 class="fw-semibold mb-3">Test Your Password</h5>

                    <!-- Password Input -->
                    <div class="mb-4">
                        <label class="form-label small">Enter your password</label>
                        <div class="input-group">
                            <input 
                                type="password" 
                                id="password" 
                                class="form-control" 
                                placeholder="Type your password here"
                                autocomplete="off"
                            >
                            <button class="btn btn-outline-secondary" type="button" id="toggleVisibility">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="form-text">
                            We don't store or transmit your password. All checking happens locally in your browser.
                        </div>
                    </div>

                    <!-- Strength Meter -->
                    <div class="mb-3">
                        <label class="form-label small">Password Strength</label>
                        <div class="strength-meter bg-light rounded" style="height: 8px; overflow: hidden;">
                            <div class="strength-bar rounded" id="strengthBar" style="height: 100%; width: 0%; transition: all 0.4s ease;"></div>
                        </div>
                        <div class="d-flex justify-content-between mt-2">
                            <small class="text-muted">Very Weak</small>
                            <small class="text-muted">Very Strong</small>
                        </div>
                    </div>

                    <!-- Strength Text -->
                    <div class="alert mb-4" id="strengthText" style="background-color: #f8f9fa; border-left: 4px solid #6c757d;">
                        <div class="fw-medium mb-1" id="strengthLabel">Password Strength: Very Weak</div>
                        <small class="text-muted" id="strengthDescription">Enter a password to see its strength</small>
                    </div>

                    <!-- Score -->
                    <div class="mb-4">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="fw-medium">Security Score</span>
                            <span class="fs-5 fw-bold" id="scoreValue">0</span>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar" id="scoreBar" role="progressbar" style="width: 0%; transition: width 0.4s ease;"></div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- ================= Requirements Checklist ================= -->
        <div class="col-md-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body p-4">
                    <h5 class="fw-semibold mb-3">Password Requirements</h5>
                    
                    <div class="mb-2">
                        <div class="d-flex align-items-center mb-2" id="reqLength">
                            <i class="fas fa-times-circle text-danger me-2"></i>
                            <span>At least 12 characters</span>
                        </div>
                        <div class="d-flex align-items-center mb-2" id="reqUpper">
                            <i class="fas fa-times-circle text-danger me-2"></i>
                            <span>Contains uppercase letters</span>
                        </div>
                        <div class="d-flex align-items-center mb-2" id="reqLower">
                            <i class="fas fa-times-circle text-danger me-2"></i>
                            <span>Contains lowercase letters</span>
                        </div>
                        <div class="d-flex align-items-center mb-2" id="reqNumbers">
                            <i class="fas fa-times-circle text-danger me-2"></i>
                            <span>Contains numbers</span>
                        </div>
                        <div class="d-flex align-items-center" id="reqSpecial">
                            <i class="fas fa-times-circle text-danger me-2"></i>
                            <span>Contains special characters</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ================= Crack Time ================= -->
        <div class="col-md-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body p-4">
                    <h5 class="fw-semibold mb-3">Time to Crack</h5>
                    
                    <div class="text-center mb-3">
                        <div class="display-5 fw-bold mb-1" id="crackTime" style="color: #7b1020;">Instantly</div>
                        <small class="text-muted" id="crackDescription">This password can be cracked instantly by a basic computer.</small>
                    </div>
                    
                    <div class="alert alert-info border-0 bg-light">
                        <i class="fas fa-shield-alt me-2"></i>
                        <small>Based on length, complexity, and common patterns</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- ================= Feedback & Tips ================= -->
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-4">
                    <h5 class="fw-semibold mb-3">
                        <i class="fas fa-lightbulb text-warning me-2"></i>
                        Feedback & Tips
                    </h5>
                    
                    <div class="alert alert-light border mb-4" id="feedbackText">
                        <p class="mb-0">Enter a password to see feedback and improvement tips.</p>
                    </div>
                    
                    <h6 class="fw-semibold mb-2">Tips for a Strong Password:</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="list-unstyled mb-0">
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    <small>Mix uppercase & lowercase</small>
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    <small>Include numbers & symbols</small>
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    <small>At least 12 characters long</small>
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-unstyled mb-0">
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    <small>Avoid common words/patterns</small>
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    <small>Use passphrases when possible</small>
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    <small>Don't reuse passwords</small>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<style>
    .strength-bar {
        transition: all 0.4s ease !important;
    }
    
    .text-brand {
        color: #4b6cb7;
    }
    
    .progress-bar {
        transition: width 0.4s ease !important;
    }
</style>

<script>
    // DOM elements
    const passwordInput = document.getElementById('password');
    const toggleVisibilityBtn = document.getElementById('toggleVisibility');
    const strengthBar = document.getElementById('strengthBar');
    const strengthLabel = document.getElementById('strengthLabel');
    const strengthDescription = document.getElementById('strengthDescription');
    const strengthText = document.getElementById('strengthText');
    const crackTime = document.getElementById('crackTime');
    const crackDescription = document.getElementById('crackDescription');
    const scoreValue = document.getElementById('scoreValue');
    const scoreBar = document.getElementById('scoreBar');
    const feedbackText = document.getElementById('feedbackText');
    
    // Requirement elements
    const reqLength = document.getElementById('reqLength');
    const reqUpper = document.getElementById('reqUpper');
    const reqLower = document.getElementById('reqLower');
    const reqNumbers = document.getElementById('reqNumbers');
    const reqSpecial = document.getElementById('reqSpecial');
    
    // Password visibility toggle
    toggleVisibilityBtn.addEventListener('click', function() {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
    });
    
    // Password strength evaluation on input
    passwordInput.addEventListener('input', function() {
        const password = this.value;
        evaluatePassword(password);
    });
    
    // Initial evaluation
    evaluatePassword('');
    
    function evaluatePassword(password) {
        // Calculate password score (0-100)
        const score = calculatePasswordScore(password);
        
        // Update visual strength indicator
        updateStrengthIndicator(score, password);
        
        // Update requirements checklist
        updateRequirementsChecklist(password);
        
        // Calculate and display crack time
        const crackTimeResult = calculateCrackTime(password);
        crackTime.textContent = crackTimeResult.time;
        crackDescription.textContent = crackTimeResult.description;
        
        // Update score
        scoreValue.textContent = score;
        scoreBar.style.width = `${score}%`;
        
        // Update score bar color based on score
        if (score < 30) {
            scoreBar.className = 'progress-bar bg-danger';
        } else if (score < 50) {
            scoreBar.className = 'progress-bar bg-warning';
        } else if (score < 70) {
            scoreBar.className = 'progress-bar bg-info';
        } else if (score < 85) {
            scoreBar.className = 'progress-bar bg-primary';
        } else {
            scoreBar.className = 'progress-bar bg-success';
        }
        
        // Update feedback
        updateFeedback(score, password);
    }
    
    function calculatePasswordScore(password) {
        let score = 0;
        const length = password.length;
        
        // Length score (max 40 points)
        if (length >= 12) score += 40;
        else if (length >= 8) score += 30;
        else if (length >= 6) score += 20;
        else if (length >= 4) score += 10;
        
        // Character variety score (max 60 points)
        const hasLower = /[a-z]/.test(password);
        const hasUpper = /[A-Z]/.test(password);
        const hasNumbers = /\d/.test(password);
        const hasSpecial = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);
        
        let varietyCount = 0;
        if (hasLower) varietyCount++;
        if (hasUpper) varietyCount++;
        if (hasNumbers) varietyCount++;
        if (hasSpecial) varietyCount++;
        
        // Variety score
        score += (varietyCount * 15); // max 60 points
        
        // Bonus for length beyond 12
        if (length > 12) {
            score += Math.min(10, (length - 12) * 2);
        }
        
        // Penalty for common patterns
        if (/(.)\1{2,}/.test(password)) score -= 10; // repeated characters
        if (/12345|qwert|asdfg/.test(password.toLowerCase())) score -= 15; // common sequences
        if (/password|admin|123456/.test(password.toLowerCase())) score -= 20; // common passwords
        
        // Ensure score is between 0 and 100
        return Math.max(0, Math.min(100, score));
    }
    
    function updateStrengthIndicator(score, password) {
        let strengthLevel, barColor, text, description, alertColor, borderColor;
        
        if (password.length === 0) {
            strengthLevel = 0;
            barColor = '#6c757d';
            text = 'Enter a password';
            description = 'Type a password to check its strength';
            alertColor = 'alert-light';
            borderColor = '#6c757d';
        } else if (score < 30) {
            strengthLevel = 20;
            barColor = '#dc3545';
            text = 'Very Weak';
            description = 'This password is easily crackable';
            alertColor = 'alert-danger';
            borderColor = '#dc3545';
        } else if (score < 50) {
            strengthLevel = 40;
            barColor = '#fd7e14';
            text = 'Weak';
            description = 'Needs significant improvement';
            alertColor = 'alert-warning';
            borderColor = '#fd7e14';
        } else if (score < 70) {
            strengthLevel = 60;
            barColor = '#0dcaf0';
            text = 'Fair';
            description = 'Could be stronger with some improvements';
            alertColor = 'alert-info';
            borderColor = '#0dcaf0';
        } else if (score < 85) {
            strengthLevel = 80;
            barColor = '#0d6efd';
            text = 'Strong';
            description = 'Good password with room for improvement';
            alertColor = 'alert-primary';
            borderColor = '#0d6efd';
        } else {
            strengthLevel = 100;
            barColor = '#198754';
            text = 'Very Strong';
            description = 'Excellent! This password is very secure';
            alertColor = 'alert-success';
            borderColor = '#198754';
        }
        
        strengthBar.style.width = `${strengthLevel}%`;
        strengthBar.style.backgroundColor = barColor;
        strengthLabel.textContent = `Password Strength: ${text}`;
        strengthDescription.textContent = description;
        strengthText.className = `alert ${alertColor} mb-4`;
        strengthText.style.borderLeft = `4px solid ${borderColor}`;
    }
    
    function updateRequirementsChecklist(password) {
        // Check each requirement
        const requirements = [
            { element: reqLength, test: password.length >= 12, text: 'At least 12 characters' },
            { element: reqUpper, test: /[A-Z]/.test(password), text: 'Contains uppercase letters' },
            { element: reqLower, test: /[a-z]/.test(password), text: 'Contains lowercase letters' },
            { element: reqNumbers, test: /\d/.test(password), text: 'Contains numbers' },
            { element: reqSpecial, test: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password), text: 'Contains special characters' }
        ];
        
        requirements.forEach(req => {
            if (req.test) {
                req.element.innerHTML = `<i class="fas fa-check-circle text-success me-2"></i><span>${req.text}</span>`;
            } else {
                req.element.innerHTML = `<i class="fas fa-times-circle text-danger me-2"></i><span>${req.text}</span>`;
            }
        });
    }
    
    function calculateCrackTime(password) {
        if (password.length === 0) {
            return { time: 'N/A', description: 'Enter a password to see how long it would take to crack.' };
        }
        
        // Simplified crack time estimation
        // Based on character set size and length
        let charsetSize = 0;
        if (/[a-z]/.test(password)) charsetSize += 26;
        if (/[A-Z]/.test(password)) charsetSize += 26;
        if (/\d/.test(password)) charsetSize += 10;
        if (/[^a-zA-Z0-9]/.test(password)) charsetSize += 32;
        
        // If no character variety detected, assume lowercase only
        if (charsetSize === 0) charsetSize = 26;
        
        // Calculate possible combinations
        const combinations = Math.pow(charsetSize, password.length);
        
        // Assume a cracking speed of 10 billion guesses per second (modern computer)
        const guessesPerSecond = 10000000000;
        const secondsToCrack = combinations / guessesPerSecond;
        
        // Convert to human readable time
        if (secondsToCrack < 1) {
            return { time: 'Instantly', description: 'This password can be cracked instantly by a basic computer.' };
        } else if (secondsToCrack < 60) {
            return { time: `${Math.round(secondsToCrack)} seconds`, description: 'This password can be cracked in seconds.' };
        } else if (secondsToCrack < 3600) {
            return { time: `${Math.round(secondsToCrack / 60)} minutes`, description: 'This password can be cracked in minutes.' };
        } else if (secondsToCrack < 86400) {
            return { time: `${Math.round(secondsToCrack / 3600)} hours`, description: 'This password would take hours to crack.' };
        } else if (secondsToCrack < 31536000) {
            return { time: `${Math.round(secondsToCrack / 86400)} days`, description: 'This password would take days to crack.' };
        } else if (secondsToCrack < 3153600000) {
            return { time: `${Math.round(secondsToCrack / 31536000)} years`, description: 'This password would take years to crack.' };
        } else if (secondsToCrack < 31536000000) {
            return { time: `${Math.round(secondsToCrack / 3153600000)} centuries`, description: 'This password would take centuries to crack.' };
        } else {
            return { time: 'Millennia', description: 'This password would take millennia to crack. Excellent!' };
        }
    }
    
    function updateFeedback(score, password) {
        if (password.length === 0) {
            feedbackText.innerHTML = '<p class="mb-0">Enter a password to see feedback and improvement tips.</p>';
            return;
        }
        
        let feedback = '';
        let alertClass = 'alert-light';
        
        if (score < 30) {
            feedback = 'Your password is very weak and could be cracked instantly. Consider using a longer password with a mix of character types.';
            alertClass = 'alert-danger';
        } else if (score < 50) {
            feedback = 'Your password is weak. Try adding more characters and different character types (uppercase, numbers, symbols).';
            alertClass = 'alert-warning';
        } else if (score < 70) {
            feedback = 'Your password is fair but could be stronger. Consider making it longer or adding more variety of characters.';
            alertClass = 'alert-info';
        } else if (score < 85) {
            feedback = 'Your password is strong! For even better security, consider making it longer or using a passphrase.';
            alertClass = 'alert-primary';
        } else {
            feedback = 'Excellent! Your password is very strong and would take an extremely long time to crack.';
            alertClass = 'alert-success';
        }
        
        // Add specific suggestions
        let suggestions = '';
        if (password.length < 12) {
            suggestions += '<li>Use at least 12 characters</li>';
        }
        if (!/[A-Z]/.test(password)) {
            suggestions += '<li>Add uppercase letters</li>';
        }
        if (!/\d/.test(password)) {
            suggestions += '<li>Include numbers</li>';
        }
        if (!/[^a-zA-Z0-9]/.test(password)) {
            suggestions += '<li>Add special characters (!@#$%)</li>';
        }
        
        if (suggestions) {
            feedback += '<div class="mt-2"><strong>Suggestions:</strong><ul class="mb-0 mt-1">' + suggestions + '</ul></div>';
        }
        
        feedbackText.className = `alert ${alertClass} border`;
        feedbackText.innerHTML = feedback;
    }
    
    // Example password for testing (optional)
    document.addEventListener('DOMContentLoaded', function() {
        // Uncomment to pre-populate with an example
        // passwordInput.value = "MySecurePass123!";
        // evaluatePassword("MySecurePass123!");
    });
</script>
{% endblock %}